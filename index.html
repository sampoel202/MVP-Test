<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Startup Diagnostic System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #F0FDF4; color: #1F2937; margin: 0; }
        .container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.08); padding: 32px 24px; }
        .progress-bar { width: 100%; background: #eee; border-radius: 5px; height: 10px; margin-bottom: 24px; }
        .progress { height: 10px; background: linear-gradient(90deg, #0D9488, #F59E0B); border-radius: 5px; transition: width 0.3s; }
        .step { display: none; }
        .step.active { display: block; }
        .form-group { margin-bottom: 24px; }
        label { font-weight: 500; display: block; margin-bottom: 8px; }
        label.required::after { content: " *"; color: #DC2626; }
        input, select, textarea { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem; background-color: #F3F4F6; }
        .button-row { display: flex; justify-content: space-between; margin-top: 24px; }
        button { padding: 10px 24px; border: none; border-radius: 5px; background-color: #0D9488; color: #fff; font-size: 1rem; cursor: pointer; }
        button:hover { background-color: #0F766E; }
        button[disabled] { background: #ccc; cursor: not-allowed; }
        .results { background: #f8f9fa; border-radius: 8px; padding: 24px; margin-top: 32px; }
        .results h2 { color: #0D9488; }
        .hidden { display: none; }
        .success-message { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error-message { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .consent-screen { text-align: center; padding: 40px 20px; }
        .consent-screen h2 { color: #0D9488; margin-bottom: 20px; }
        .consent-screen p { margin-bottom: 30px; line-height: 1.6; }
        .consent-buttons { display: flex; gap: 15px; justify-content: center; }
        .consent-buttons button:first-child { background-color: #0D9488; }
        .consent-buttons button:last-child { background-color: #6B7280; }
        .metric-score { display: flex; align-items: center; margin: 10px 0; }
        .metric-score .label { flex: 1; }
        .metric-score .score { width: 100px; text-align: right; font-weight: bold; }
        .score-red { color: #DC2626; }
        .score-amber { color: #F59E0B; }
        .score-green { color: #059669; }
        .recommendations { background: #FEF3C7; border-left: 4px solid #F59E0B; padding: 15px; margin: 20px 0; }
        .other-input { margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="consentScreen" class="consent-screen">
            <h2>Before we begin...</h2>
            <p>We use this tool to assess startups and improve our support programmes. By continuing, you agree that your answers may be used for internal analysis.</p>
            <div class="consent-buttons">
                <button onclick="startForm()">Accept and Continue</button>
                <button onclick="window.location.href='https://google.com'">Decline</button>
            </div>
        </div>
        
        <div id="mainForm" class="hidden">
            <h1>Startup Diagnostic - Initial Assessment</h1>
            <div class="progress-bar"><div class="progress" id="progress" style="width: 0%"></div></div>
            <form id="startupForm">
                <!-- Steps will be injected here by JS -->
            </form>
            <div class="results hidden" id="results"></div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let totalSteps = 26;
        let answers = {};
        let stageResult = {};
        let stageSpecificAnswers = {};
        let currentStageStep = 1;
        let totalStageSteps = 0;

        // All 26 questions in ORIGINAL ORDER with mandatory fields marked
        const questions = [
            { id: 1, label: "Founder Name", name: "founderName", type: "text", placeholder: "e.g. John Smith", required: true },
            { id: 2, label: "Email", name: "email", type: "email", placeholder: "e.g. john@company.com", required: true },
            { id: 3, label: "Company Name", name: "companyName", type: "text", placeholder: "e.g. TechStart Ltd", required: true },
            { id: 4, label: "Company Website", name: "companyWebsite", type: "url", placeholder: "https://yourcompany.com" },
            { id: 5, label: "In a few sentences, describe the opportunity and how your solution is best placed to address it?", name: "opportunitySolution", type: "textarea", placeholder: "Describe your opportunity and solution..." },
            { id: 6, label: "Why is now the right time to build the solution?", name: "whyNow", type: "textarea", placeholder: "Explain why now is the right time..." },
            { id: 7, label: "How clearly have you defined your target market and competitive edge at this stage?", name: "marketSizing", type: "select", options: [
                "We're still exploring — haven't clearly defined our target market or competitors yet.",
                "We have a rough idea of our target market and early signs of competitor activity.",
                "We've completed TAM/SAM/SOM sizing and identified key competitors.",
                "We have TAM/SAM/SOM + clear articulation of how we differ from existing solutions.",
                "We deeply understand market dynamics, supported by robust TAM/SAM/SOM + competitor analysis."
            ]},
            { id: 8, label: "Who is your target customer/user? Why are they a good fit for your solution?", name: "targetCustomer", type: "textarea", placeholder: "Describe your target customer..." },
            { id: 9, label: "How many paying customers or active users do you currently have?", name: "customers", type: "number", placeholder: "e.g. 25", required: true },
            { id: 10, label: "Roughly what % of your current customers or users are actively engaging with the product at least monthly?", name: "engagementQuality", type: "select", options: [
                "Not applicable", "Less than 10%", "10–30%", "30–60%", "Over 60%"
            ], required: true },
            { id: 11, label: "How are you currently acquiring your customers?", name: "goToMarket", type: "select", options: [
                "Haven't started acquiring yet", "Founder-led outreach or referrals", "Word of mouth / organic demand",
                "Paid marketing or ads", "Partnerships / channel sales", "Dedicated sales team or GTM function"
            ], required: true },
            { id: 12, label: "What best describes your primary business model?", name: "businessModel", type: "select", options: [
                "B2B (selling to businesses)", "B2C (selling to consumers)", "B2G (selling to government)",
                "Marketplace (buyers & sellers)", "Direct-to-Consumer (D2C)", "Subscription (e.g., SaaS)",
                "Consumer App", "Other (please specify)"
            ], required: true },
            { id: 13, label: "Which region is your company primarily operating in?", name: "region", type: "select", options: [
                "North America (US, Canada)", "Western Europe (e.g. UK, Germany, France, Nordics etc.)",
                "Australia & New Zealand", "Central & Eastern Europe", "Latin America", "Sub-Saharan Africa",
                "Middle East & North Africa (MENA)", "South Asia (e.g. India, Pakistan)",
                "Southeast Asia (e.g. Indonesia, Vietnam, Philippines)", "East Asia (e.g. China, Japan, Korea, Singapore)", "Other (please specify)"
            ], required: true },
            { id: 14, label: "Which category best describes your business type?", name: "businessType", type: "select", options: [
                "SaaS (Software as a Service)", "Marketplace (connecting buyers/sellers)", "E-commerce / DTC",
                "Hardware / Devices", "Services (e.g. consulting, agency)", "Platform / API-based",
                "Community or Content-led", "Other (please specify)"
            ], required: true },
            { id: 15, label: "What industry are you in?", name: "industry", type: "select", options: [
                "Software / SaaS", "Fintech / Insurtech", "Health / MedTech", "E-commerce / DTC",
                "Deep Tech / AI / Robotics", "Education / EdTech", "Social Impact / Nonprofit", "Other (please specify)"
            ], required: true },
            { id: 16, label: "What best describes the current state of your product?", name: "productReadiness", type: "select", options: [
                "Idea or concept only", "Wireframes / mockups", "MVP built (not in use)",
                "MVP being tested with early users", "Live product with active users",
                "Fully launched and scaled", "Not applicable / unknown"
            ], required: true },
            { id: 17, label: "What is your total revenue in the past 12 months (USD)?", name: "revenue", type: "number", placeholder: "e.g. 25000", required: true },
            { id: 18, label: "How many months of runway do you currently have based on your cash on hand and current burn?", name: "runway", type: "number", placeholder: "e.g. 6", step: "0.5", required: true },
            { id: 19, label: "How much funding have you raised to date (USD)?", name: "funding", type: "number", placeholder: "e.g. 100000", required: true },
            { id: 20, label: "Which of the following additional signals of traction or customer validation has your business achieved? (Select all that apply)", name: "tractionSignals", type: "checkbox", options: [
                "Pilot or beta programme completed with users", "Active user or customer engagement",
                "Signed commercial or strategic agreements (LOIs, MOUs, etc.)", "Channel partner actively generating leads",
                "10+ customer discovery interviews or UX tests", "Validation that changed product or GTM direction",
                "Qualified waitlist with warm intent", "Inbound partner or ecosystem interest",
                "Press, analyst, or ecosystem recognition", "Funnel metrics actively tracked", "None of the above"
            ]},
            { id: 21, label: "Outline the backgrounds of the founders in your business. Why are you best placed to make this solution work?", name: "founderProfiles", type: "textarea", placeholder: "Describe founder backgrounds and fit..." },
            { id: 22, label: "Including founders, how many people are currently on your team (full-time equivalents)?", name: "teamSize", type: "number", placeholder: "e.g. 3", min: "1", required: true },
            { id: 23, label: "What's the story behind how you started working on this business?", name: "teamStory", type: "textarea", placeholder: "Tell the story of how you started..." },
            { id: 24, label: "How are you currently identifying and addressing key risks or assumptions in the business?", name: "risksAssumptions", type: "select", options: [
                "We've started thinking through key risks and assumptions but haven't formalised anything yet.",
                "We've identified a few major assumptions (e.g. demand, pricing, team), and are working out how to test them.",
                "We're actively testing high-risk assumptions through user feedback, pilots, or experiments.",
                "We've validated core assumptions and now track remaining risks with basic systems or tools.",
                "We've built a systematic approach to monitoring and mitigating risks across functions (e.g. ops, product, compliance)."
            ]},
            { id: 25, label: "What goals are you looking to achieve over the coming 6 months with your business?", name: "goals", type: "checkbox", options: [
                "Launch a product or MVP with early users", "Test and validate solution with real users",
                "Acquire early customers or drive growth", "Raise investment", "Make key hires or build out the team",
                "Improve financial planning or extend runway", "Understand my ideal customer or positioning", "Other (please specify)"
            ]},
            { id: 26, label: "Anything else you think we should know about your business at this time?", name: "otherInformation", type: "textarea", placeholder: "Any additional information..." }
        ];

        // Stage-specific questions
        const stageQuestions = {
            "Ideation": [
                { label: "Which of the following best describes how you've defined and validated your initial customer segment?", name: "ideation_customer_profile", type: "select", options: [
                    "We haven't clearly defined our target customers yet.",
                    "We have a rough idea of who our customers might be, but haven't tested it.",
                    "We've had informal conversations with some potential customers.",
                    "We've conducted structured discovery with real potential customers and refined our understanding.",
                    "We have a clearly defined customer profile based on patterns validated through discovery conversations."
                ]},
                { label: "How clearly have you defined what your MVP needs to include — and why those features matter?", name: "ideation_mvp_scope", type: "select", options: [
                    "We haven't defined our MVP features or scope yet.",
                    "We've listed ideas, but haven't prioritized or linked them to the problem.",
                    "We have a rough MVP scope based on assumptions, not user input.",
                    "We've defined core features based on problem-solution fit and feasibility.",
                    "We've scoped our MVP tightly with a clear reason for each feature."
                ]},
                { label: "How well-defined is your business model at this stage?", name: "ideation_business_model", type: "select", options: [
                    "We have a clear business model – we know what we're selling, who pays, how they pay, and how it scales.",
                    "We have an initial business model and revenue logic, but still need to validate key assumptions.",
                    "We're still exploring different business model options or customer segments.",
                    "We have a broad idea, but haven't defined what we're selling or how it generates revenue.",
                    "We haven't focused on the business model yet."
                ]},
                { label: "How would you describe your current thinking around how to reach your early users or customers?", name: "ideation_gtm_thinking", type: "select", options: [
                    "We haven't thought much about GTM yet.",
                    "We have some rough GTM ideas but they're untested.",
                    "We've identified potential channels and pricing strategies to explore.",
                    "We've mapped early GTM hypotheses and started outlining experiments.",
                    "We have a clear GTM concept and a few experiments ready to test."
                ]},
                { label: "How well-positioned is your current team to deliver on the technical and product execution needed at this stage?", name: "ideation_team_technical", type: "select", options: [
                    "No one has relevant technical experience or product execution history.",
                    "One founder has some technical/product exposure.",
                    "Some relevant experience, but light in delivery track record.",
                    "Strong technical/product capability in-house.",
                    "Deep, proven experience building and launching similar products."
                ]},
                { label: "How well-positioned is your current team to deliver on the commercial and go-to-market execution needed at this stage?", name: "ideation_team_commercial", type: "select", options: [
                    "No commercial, sales, or growth experience in the team.",
                    "Some exposure to customer engagement or pitching.",
                    "One founder has decent experience in sales or marketing.",
                    "Clear experience driving early GTM or commercial traction.",
                    "Deep experience scaling early-stage GTM strategies."
                ]},
                { label: "How clearly have you defined your fundraising goals and demonstrated why you're ready to raise?", name: "ideation_fundraising_readiness", type: "select", options: [
                    "No clear funding need, unclear investor type or use of funds.",
                    "Vague understanding of funding need, minimal clarity on use of funds.",
                    "Funding target loosely defined, early sense of investor type and use.",
                    "Clear fundraising goal with identified investor type and planned use.",
                    "Defined raise, investor fit, MVP scope, and early need validation."
                ]},
                { label: "How clearly have you mapped out your near-term goals, milestones, and ways to track progress?", name: "ideation_milestones_progress", type: "select", options: [
                    "No milestones or future planning yet.",
                    "General ideas, but no clear timelines or owners.",
                    "Clear goals for next 2–3 months.",
                    "Defined milestones with timelines.",
                    "Shared roadmap with stakeholders and tracking in place."
                ]}
            ],
            "Validation": [
                { label: "How have you validated that your solution addresses a real user need?", name: "validation_solution_value", type: "select", options: [
                    "We've tested the solution with real users and can show strong engagement, retention, or conversion metrics.",
                    "We've received direct feedback from users confirming the value of our solution.",
                    "We've seen repeat usage or buying intent from early users.",
                    "We've conducted informal testing or pilots but haven't gathered structured evidence yet.",
                    "We haven't tested the solution with real users yet."
                ]},
                { label: "How would you describe the way potential customers are engaging with your solution or problem space?", name: "validation_icp_behaviour", type: "select", options: [
                    "We've had no meaningful engagement from potential customers yet.",
                    "We've had early chats but no strong evidence of interest.",
                    "A few have shown interest but it's inconsistent or unclear.",
                    "We're seeing repeated interest or intent signals from a clear profile.",
                    "We have strong and consistent behavioural signals that align with our ICP."
                ]},
                { label: "How well do you understand which segments and channels are gaining the most traction — and how your offering compares to competitors?", name: "validation_segment_traction", type: "select", options: [
                    "We've done little to no tracking of segments, channels, or competitors yet.",
                    "We've seen some early signs of traction in certain segments or channels, but haven't dug deep.",
                    "We've started analysing which segments or channels work, and have noted some competitor patterns.",
                    "We have a solid handle on which segments and channels are performing, with some competitor insight.",
                    "We have deep insight into segment traction, channel effectiveness, and how we're positioned vs competitors."
                ]},
                { label: "What have you learned from MVP testing — and how ready are you to deliver and support it at scale?", name: "validation_mvp_testing", type: "select", options: [
                    "We haven't tested the MVP yet, or it's too early to assess.",
                    "We've started basic testing, but key usability issues and delivery risks remain unresolved.",
                    "We've run some user testing and made basic improvements, but delivery systems still need work.",
                    "We've refined the MVP based on testing and have a clear roadmap for delivery and support.",
                    "MVP is well-tested with improvements made, and we're confident in our ability to deliver and support at scale."
                ]},
                { label: "How would you describe the experiments or strategies you've tested to find effective ways to reach your customers?", name: "validation_gtm_experimentation", type: "select", options: [
                    "We haven't run any GTM experiments yet.",
                    "We've run a few GTM tests but haven't learned much.",
                    "Some GTM experiments have shown promising signals.",
                    "We're seeing patterns around what works in messaging or channels.",
                    "We have clear learnings guiding our GTM strategy."
                ]},
                { label: "How would you describe the user behaviour or traction signals you're currently seeing — and what they indicate?", name: "validation_traction_signals", type: "select", options: [
                    "We haven't seen meaningful engagement or usage patterns yet.",
                    "We've seen isolated user activity but not enough to identify a pattern.",
                    "Some early traction is emerging but it's unclear what it means.",
                    "We're seeing repeated usage or behaviours that align with our problem-solution fit.",
                    "We have consistent traction signals that clearly validate product–market alignment."
                ]},
                { label: "Where do you currently stand in identifying and addressing key capability gaps (e.g. tech, marketing, operations)?", name: "validation_resource_gaps", type: "select", options: [
                    "We have major capability gaps and no clear plan to fill them.",
                    "We know we're missing key skills, but only starting to figure out next steps.",
                    "Some gaps exist, and we're loosely working on them.",
                    "Minor gaps remain — we've prioritised key hires or solutions.",
                    "We've mapped resourcing needs clearly and are actively filling them."
                ]},
                { label: "Beyond your current revenue, have you mapped out a clear financial plan for growth — including your projected revenue, funding use, and any early signs of efficiency?", name: "validation_financial_planning", type: "select", options: [
                    "No financial projections or plans for funding use yet.",
                    "Basic ideas exist but unclear or disconnected from goals.",
                    "Have started modeling revenue and planning use of funds, but still rough.",
                    "Revenue projections and funding plan are defined with some tested assumptions.",
                    "Clear financial model with 12–18 month projections, allocation plan, and early efficiency metrics (CAC, payback)."
                ]},
                { label: "How well prepared are you for raising your next round of funding? (Consider your pitch narrative, investor profile, funding goals, and supporting materials.)", name: "validation_fundraising_preparation", type: "select", options: [
                    "We haven't defined a narrative or target investor profile yet.",
                    "We've drafted a basic narrative but haven't tested or refined it.",
                    "We have a clear narrative and pitch, but still identifying the right investors.",
                    "We've defined our investor profile and have supporting pitch materials ready.",
                    "We're actively engaging investors with a strong, tested narrative and clear ask."
                ]},
                { label: "How clearly have you defined your early targets (e.g. users, revenue, engagement) — and tested the assumptions that matter most right now (like demand or pricing)?", name: "validation_risk_assumption_review", type: "select", options: [
                    "We haven't defined clear targets or tested key assumptions yet.",
                    "We've defined a few targets, but they're vague and assumptions are mostly untested.",
                    "We've defined specific goals, and have started testing key assumptions.",
                    "Our targets are clear and based on structured assumption testing (e.g. pricing, demand).",
                    "We've validated core assumptions and use our targets to guide focused execution."
                ]}
            ],
            "Early Traction": [
                { label: "How would you describe your understanding of how customers are using and staying engaged with your product or service?", name: "early_traction_customer_retention", type: "select", options: [
                    "We don't yet track how customers use or stay with our product.",
                    "We occasionally review some usage data but it's not consistent.",
                    "We have basic retention or usage data but limited analysis.",
                    "We track usage and retention systematically and review patterns.",
                    "We have a clear view of retention trends and identify expansion signals."
                ]},
                { label: "Which customer segments are showing the strongest traction, and how are you responding to competitive shifts or market demand signals?", name: "early_traction_market_signals", type: "select", options: [
                    "We haven't identified clear pull from any segment yet.",
                    "Some signs of interest from certain segments, but it's early and inconsistent.",
                    "Clear pull from one or two segments, but we haven't adapted positioning or messaging yet.",
                    "Strong pull from specific segments, and we're beginning to adjust positioning.",
                    "Clear segment traction and refined positioning based on competitor moves and market dynamics."
                ]},
                { label: "How well is your product performing with real users — and is your tech ready to scale with them?", name: "early_traction_product_usage", type: "select", options: [
                    "We're still collecting usage feedback and haven't addressed any scaling issues.",
                    "We've identified some issues from users or usage spikes, but haven't acted on them.",
                    "We've addressed surface-level bugs or UX issues, but deeper usage or scaling risks remain.",
                    "We've improved key UX friction points and resolved core tech bottlenecks.",
                    "Our product is resonating with users and our systems are handling growth without issues."
                ]},
                { label: "How clearly have you defined your go-to-market system — including your sales/marketing funnel, channel tests, and how you're learning what resonates with customers?", name: "early_traction_gtm_execution", type: "select", options: [
                    "We haven't structured GTM efforts yet.",
                    "We're experimenting but don't have a clear system.",
                    "We have a basic funnel and run some GTM tests.",
                    "We actively learn from funnel data and messaging experiments.",
                    "We have a repeatable GTM system with clear insights by segment."
                ]},
                { label: "What systems or processes have you established to support delivery and team scalability?", name: "early_traction_ops_scalability", type: "select", options: [
                    "No systems or defined processes yet.",
                    "Some informal processes in place, but inconsistent.",
                    "Defined lightweight systems or tools in early use.",
                    "Clear ownership of ops/CS/QA roles and basic delivery metrics tracked.",
                    "Processes and metrics (SLAs, NPS, resolution time) actively used to manage performance."
                ]},
                { label: "How well have you addressed your startup's basic legal and compliance responsibilities?", name: "early_traction_legal_compliance", type: "select", options: [
                    "Haven't reviewed legal or compliance requirements.",
                    "Basic IP/contracts reviewed but nothing formal.",
                    "Some key documents in place (e.g. NDAs).",
                    "Legal docs mostly ready, and sector-specific compliance considered.",
                    "All key legal docs in place and compliance risks identified and addressed."
                ]},
                { label: "How clearly can you see that users are getting value from your product — and moving toward becoming paying customers?", name: "early_traction_activation_monetization", type: "select", options: [
                    "We haven't defined what 'value' means yet.",
                    "Some users get value, but few convert to paying.",
                    "There's early signs of both value and conversion.",
                    "A decent % of users convert and stick.",
                    "Strong value delivery and reliable monetisation."
                ]},
                { label: "What capability or capacity gaps could hold back your next phase of execution, and how are you addressing them?", name: "early_traction_capability_gaps", type: "select", options: [
                    "Team under pressure — struggling to deliver current roadmap.",
                    "Major gaps limiting progress — no clear plan to solve.",
                    "Clear capability gaps, actively hiring or partnering to fill them.",
                    "Minor gaps in specific roles or skills, already planning to address.",
                    "No major gaps — team is resourced and executing well."
                ]},
                { label: "How are you building culture and supporting team performance as your team begins to scale?", name: "early_traction_people_culture", type: "select", options: [
                    "No real onboarding or cultural practices in place.",
                    "Ad hoc onboarding; no performance feedback yet.",
                    "Starting to define culture; some onboarding basics in place.",
                    "Onboarding process and informal feedback exist.",
                    "Strong culture-building; onboarding and feedback systems actively used."
                ]},
                { label: "How well developed is your financial planning — including your revenue model and ability to forecast different paths forward?", name: "early_traction_financial_planning", type: "select", options: [
                    "No real forecasting or financial planning in place.",
                    "Very rough estimates; limited link to actual performance.",
                    "Have some projections and a working revenue model, but not updated regularly.",
                    "Forecasts are updated with real data; strategy includes burn and revenue streams.",
                    "Financial plan is dynamic — includes updated burn, revenue projections, and multiple scenarios."
                ]},
                { label: "How well developed is your investment story and fundraising process? (Consider traction data, proof points, investor targeting, and outreach process.)", name: "early_traction_investment_narrative", type: "select", options: [
                    "We haven't started refining our story or identifying investors yet.",
                    "We've drafted our pitch narrative but have limited traction or proof points.",
                    "We've pulled together traction data and know the types of investors to target.",
                    "We have clear proof points and are actively targeting aligned investors with a defined outreach process.",
                    "We're engaging investors with a compelling narrative, solid metrics, and structured outreach."
                ]},
                { label: "How clearly have you mapped out your growth priorities for the next few months and aligned your team around them?", name: "early_traction_strategic_planning", type: "select", options: [
                    "No clear priorities or alignment yet.",
                    "Some general priorities identified, but not shared across team.",
                    "Priorities defined and loosely tracked.",
                    "Priorities linked to goals and timelines.",
                    "Shared, tracked plan with clear ownership and alignment"
                ]},
                { label: "How confident are you that your startup is ready to scale — from a tech, team, and operations standpoint?", name: "early_traction_scale_readiness", type: "select", options: [
                    "We haven't assessed scale readiness yet.",
                    "We see some blockers, but haven't addressed them.",
                    "We've started resolving key issues.",
                    "Most blockers addressed, some plans in place.",
                    "Fully confident — we're structurally ready to grow"
                ]}
            ],
            "Growth": [
                { label: "How would you describe your current approach to ensuring customers are retained, supported, and expanding over time?", name: "growth_customer_retention", type: "select", options: [
                    "We don't have any structured customer success or retention strategy.",
                    "We respond to issues reactively but don't track success or outcomes.",
                    "We have some customer-facing support processes but they're inconsistent.",
                    "We've defined success outcomes and actively work to retain and expand customers.",
                    "We have a structured customer success system with retention and expansion goals, tactics, and tracking in place."
                ]},
                { label: "How clearly are you differentiating from competitors in your positioning, and how often do you adapt your messaging as the market evolves?", name: "growth_competitive_differentiation", type: "select", options: [
                    "Our positioning isn't clearly differentiated and rarely updated.",
                    "We know who our competitors are, but our messaging doesn't strongly highlight our differences.",
                    "We highlight a few key differences, but our positioning needs sharpening.",
                    "We regularly track competitors and refine our messaging based on what we learn.",
                    "Our positioning is highly differentiated, updated often, and reinforced across GTM assets."
                ]},
                { label: "How well is your product scaling — both in terms of features for different users and system reliability under growth?", name: "growth_product_depth", type: "select", options: [
                    "Our product isn't scaling well and we haven't adapted features or infra for growth.",
                    "We've made basic improvements, but still face UX or system issues under load.",
                    "We've started expanding features or scaling infra, but there are still blockers.",
                    "We're expanding features based on segment feedback and strengthening systems.",
                    "Our product is scaling confidently across user types, and our systems are stable under growth."
                ]},
                { label: "How would you describe your current go-to-market engine — including your use of channels, ability to generate pipeline, and how effectively you're scaling GTM operations?", name: "growth_gtm_engine", type: "select", options: [
                    "GTM growth is still founder-led and inconsistent.",
                    "We have 1–2 working channels but no repeatable engine.",
                    "We have an emerging GTM system but it's not scalable yet.",
                    "We've built reliable GTM systems with early team/process scale.",
                    "We're confidently scaling pipeline, channels, and sales ops."
                ]},
                { label: "How effectively are your systems supporting scalable operations and team decision-making?", name: "growth_systems_tooling", type: "select", options: [
                    "No systems or automation in place.",
                    "Some tools used manually, but no integration or dashboards.",
                    "Basic automation or dashboards in limited use.",
                    "Repeatable systems in place across functions with visibility into ops.",
                    "Automated systems, shared dashboards, and low manual effort across key teams."
                ]},
                { label: "How prepared are you to manage regulatory and compliance risks across new markets or segments?", name: "growth_regulatory_compliance", type: "select", options: [
                    "No formal compliance planning.",
                    "Ad hoc legal posture reviews.",
                    "Identified key risks, with some compliance plans in place.",
                    "Compliance approach aligned to new markets or customer types.",
                    "Proactive compliance management across legal, regulatory, and security domains."
                ]},
                { label: "How well are you tracking and using data to understand whether your user or revenue growth is sustainable?", name: "growth_sustainable_metrics", type: "select", options: [
                    "We don't track retention or user quality.",
                    "We track some metrics but don't use them regularly.",
                    "We track and review retention and growth signals but rarely act on them.",
                    "We actively use growth and retention trends to guide product decisions.",
                    "We track cohorts, NPS, and funnel signals to guide growth investments."
                ]},
                { label: "How structured and scalable is your team's leadership, decision-making, and performance approach?", name: "growth_org_structure", type: "select", options: [
                    "No formal structure or leadership development.",
                    "Some informal leads but unclear roles or ownership.",
                    "Partial structure; limited leadership or feedback practices.",
                    "Defined structure and growing leadership maturity.",
                    "Strong leadership, structure, and performance culture."
                ]},
                { label: "How strong is your financial discipline in terms of growth forecasting, revenue strategy, and cost control?", name: "growth_financial_discipline", type: "select", options: [
                    "Forecasting is ad hoc and we don't update projections consistently.",
                    "Some visibility into revenue and spend, but no real growth planning or controls.",
                    "Basic revenue model and cost tracking in place, but not tightly linked to growth.",
                    "Strong forecasting with cost controls and evolving monetization model.",
                    "Robust discipline — 12–24 month forecasts, cost controls, and optimised monetisation tied to growth segments."
                ]},
                { label: "How prepared are you for institutional fundraising and ongoing investor/board engagement? (Consider materials, metrics, board cadence, and reporting.)", name: "growth_institutional_fundraising", type: "select", options: [
                    "We haven't begun preparing for institutional investors or board engagement.",
                    "We've started gathering materials and discussing investor needs but still have key gaps.",
                    "We have the basics in place (e.g. deck, data room, investor conversations) and are engaging our board periodically.",
                    "We're actively engaging institutional investors and maintaining a consistent board/investor comms rhythm.",
                    "We're fully prepared for institutional rounds with clear reporting and board alignment."
                ]},
                { label: "How clearly have you defined your top strategic priorities — and are they visible, owned, and tracked across the team?", name: "growth_strategic_focus", type: "select", options: [
                    "No clear strategic priorities yet.",
                    "Some priorities defined, but not shared widely or tracked.",
                    "Priorities defined, with informal tracking.",
                    "Priorities tracked with some ownership.",
                    "Priorities linked to OKRs or roadmap, with ownership and team-wide alignment."
                ]},
                { label: "Have you begun developing a repeatable playbook for market, product, or segment expansion?", name: "growth_expansion_playbook", type: "select", options: [
                    "No expansion plans or activity yet.",
                    "Considering expansion options, but no structure.",
                    "Pilot efforts started with limited learnings.",
                    "Some repeatable success in early expansions.",
                    "Structured playbook with tracked KPIs, risks, and repeatability criteria"
                ]}
            ],
            "Scale": [
                { label: "How would you describe your approach to managing different customer segments and turning success into market influence?", name: "scale_enterprise_portfolio", type: "select", options: [
                    "We manage all customers the same and don't track outcomes.",
                    "We handle some customers differently but it's not strategic.",
                    "We've started segmenting customers and capturing some success stories.",
                    "We have a structured approach to segment management and track customer outcomes.",
                    "We run a portfolio model with segment-based playbooks, tracked outcomes, and use cases that support market credibility."
                ]},
                { label: "How clearly have you prioritized market segments across regions or verticals, and how are you tracking competitive shifts to inform positioning?", name: "scale_segment_strategy", type: "select", options: [
                    "We haven't clearly prioritized segments or tracked market dynamics.",
                    "We have basic segment ideas, but limited structure or consistency.",
                    "We're starting to prioritize segments regionally, but lack solid data or a consistent approach.",
                    "We've defined priority segments and adapt strategy with some monitoring of competitor/category shifts.",
                    "We've mapped core/emerging segments by region and track category shifts to refine global positioning."
                ]},
                { label: "How prepared are you for international expansion in terms of market insights, sequencing, and local team enablement?", name: "scale_market_intelligence", type: "select", options: [
                    "We haven't explored international expansion or done any research.",
                    "We've done some initial thinking but no structured market analysis or planning.",
                    "We've identified priority markets and have begun some research or basic frameworks.",
                    "We've defined a market entry strategy and built frameworks for sequencing and risk.",
                    "We have a defined strategy, regular intelligence gathering, and enablement systems for local teams."
                ]},
                { label: "How prepared is your product to scale as a platform — and deliver value reliably across a broad customer base?", name: "scale_platform_ecosystem", type: "select", options: [
                    "We're not yet thinking about extensibility, scale, or enterprise reliability.",
                    "We've made early efforts, but gaps remain in platform readiness and system stability.",
                    "We're working on APIs/integrations or infra improvements, but customer impact is inconsistent.",
                    "We've launched platform elements and improved system reliability for key segments.",
                    "Our product delivers consistent value at scale, with strong platform infrastructure and extensibility."
                ]},
                { label: "How are you scaling your go-to-market strategy across different regions, channels, or customer types?", name: "scale_international_gtm", type: "select", options: [
                    "We haven't adapted GTM strategy for scale yet.",
                    "We've started thinking about channels or regions but not executing.",
                    "We're testing new GTM strategies in a few areas.",
                    "We're executing targeted strategies across multiple segments.",
                    "We have tailored GTM execution across markets, channels, and buyer types."
                ]},
                { label: "How well have you institutionalised systems and processes to ensure consistent, high-quality delivery across regions and functions?", name: "scale_enterprise_systems", type: "select", options: [
                    "We're still mostly relying on ad hoc tools or informal processes across key functions.",
                    "We've introduced some systems and defined processes, but consistency and oversight vary by team or region.",
                    "We've implemented key systems and standardised delivery workflows, with some tracking in place.",
                    "Our systems, processes, and governance frameworks are consistent across functions, with performance tracking in place.",
                    "We have enterprise-grade systems, clearly defined governance, and full visibility into delivery quality and operations globally."
                ]},
                { label: "How well does your team use centralized data to inform planning and decision-making at scale?", name: "scale_central_data_platform", type: "select", options: [
                    "We use centralized, reliable data and dashboards to support strategic planning, forecasting, and real-time decisions across functions.",
                    "We have dashboards and models in place for some areas (e.g., finance or GTM), but not consistently across the org.",
                    "We've started centralizing key data, but usage is mostly limited to reporting – not proactive planning.",
                    "We track some data manually or in silos, but we don't use it to guide strategic decisions.",
                    "We don't yet have centralized data infrastructure or planning models."
                ]},
                { label: "How clearly are you identifying and improving the leverage points across your business — like sales efficiency, operational cost, or margins?", name: "scale_business_leverage", type: "select", options: [
                    "We haven't assessed these yet.",
                    "We've looked at some, but not tracked them consistently.",
                    "We've started tracking a few key ratios or team efficiencies.",
                    "We actively track cost/margin and adjust operations.",
                    "We benchmark and optimise across multiple business functions."
                ]},
                { label: "How well are you evolving your leadership team, succession plans, and org structure for long-term scale?", name: "scale_org_design", type: "select", options: [
                    "No formal succession or leadership scaling efforts.",
                    "Informal structure with unclear ownership or long-term planning.",
                    "Early discussions on succession/org design.",
                    "Defined ownership + starting LTIP/talent planning.",
                    "Clear succession, LTIP, and scalable org in place."
                ]},
                { label: "How would you describe your maturity in financial control, capital allocation, and forecasting sustainability at scale?", name: "scale_capital_allocation", type: "select", options: [
                    "No formal capital allocation or reporting processes yet.",
                    "Budgeting exists, but we don't track actuals vs. forecasts in detail.",
                    "Some controls in place — forecasts, board reporting, and audit prep started.",
                    "Strong systems — regular board packs, cap efficiency metrics, financial controls.",
                    "Full maturity — disciplined capital allocation, audit readiness, and efficient scaling with investor-grade reporting."
                ]},
                { label: "How well-prepared is your company for long-term strategic options — and how effectively are you engaging your board on them?", name: "scale_strategic_optionality", type: "select", options: [
                    "No clear thinking on exits or strategic paths, minimal board engagement.",
                    "Some discussions started, but no structured planning.",
                    "Options loosely defined, early board involvement.",
                    "Defined strategic paths, regular board input.",
                    "Strategic paths planned with metrics and active board alignment"
                ]},
                { label: "How intentionally are you using partnerships or acquisitions to accelerate scale?", name: "scale_inorganic_growth", type: "select", options: [
                    "We're actively executing strategic partnerships or acquisitions with structured frameworks in place (e.g., due diligence, integration, success metrics).",
                    "We've identified potential partners or targets and are preparing internal capabilities to act.",
                    "We're exploring inorganic options but haven't made structured plans yet.",
                    "We aren't currently pursuing partnerships or M&A as part of our growth strategy.",
                    "We don't see partnerships or acquisitions playing a role for us in the foreseeable future."
                ]}
            ]
        };

        // Initialize form
        function startForm() {
            document.getElementById('consentScreen').style.display = 'none';
            document.getElementById('mainForm').style.display = 'block';
            initializeForm();
        }

        function initializeForm() {
            const form = document.getElementById('startupForm');
            form.innerHTML = '';
            
            questions.forEach((question, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = `step ${index === 0 ? 'active' : ''}`;
                stepDiv.id = `step${index + 1}`;
                
                stepDiv.innerHTML = `
                    <h2>Question ${index + 1} of ${questions.length}</h2>
                    <div class="form-group">
                        <label for="${question.name}" class="${question.required ? 'required' : ''}">${question.label}</label>
                        ${generateInput(question)}
                    </div>
                    <div class="button-row">
                        ${index > 0 ? '<button type="button" onclick="prevStep()">Back</button>' : '<div></div>'}
                        ${index < questions.length - 1 ? '<button type="button" onclick="nextStep()">Continue</button>' : '<button type="button" onclick="calculateStage()">Get Results</button>'}
                    </div>
                `;
                
                form.appendChild(stepDiv);
            });
            
            updateProgress();
        }

        function generateInput(question) {
            switch(question.type) {
                case 'text':
                case 'email':
                case 'url':
                    return `<input type="${question.type}" id="${question.name}" name="${question.name}" placeholder="${question.placeholder || ''}" ${question.required ? 'required' : ''}>`;
                case 'number':
                    return `<input type="number" id="${question.name}" name="${question.name}" placeholder="${question.placeholder || ''}" ${question.min ? `min="${question.min}"` : ''} ${question.step ? `step="${question.step}"` : ''} ${question.required ? 'required' : ''}>`;
                case 'textarea':
                    return `<textarea id="${question.name}" name="${question.name}" placeholder="${question.placeholder || ''}" rows="4" ${question.required ? 'required' : ''}></textarea>`;
                case 'select':
                    let options = '<option value="">Please select...</option>';
                    question.options.forEach(option => {
                        options += `<option value="${option}">${option}</option>`;
                    });
                    let selectHtml = `<select id="${question.name}" name="${question.name}" ${question.required ? 'required' : ''} onchange="handleOtherOption(this)">${options}</select>`;
                    
                    // Add "Other" input field if the question has "Other" options
                    if (question.options.some(opt => opt.includes('Other'))) {
                        selectHtml += `<input type="text" id="${question.name}_other" name="${question.name}_other" placeholder="Please specify..." class="other-input" style="display: none;">`;
                    }
                    
                    return selectHtml;
                case 'checkbox':
                    let checkboxes = '';
                    question.options.forEach(option => {
                        checkboxes += `<label><input type="checkbox" name="${question.name}" value="${option}" onchange="handleOtherCheckbox(this)"> ${option}</label><br>`;
                    });
                    let checkboxHtml = `<div>${checkboxes}</div>`;
                    
                    // Add "Other" input field if the question has "Other" options
                    if (question.options.some(opt => opt.includes('Other'))) {
                        checkboxHtml += `<input type="text" id="${question.name}_other" name="${question.name}_other" placeholder="Please specify..." class="other-input" style="display: none;">`;
                    }
                    
                    return checkboxHtml;
                default:
                    return `<input type="text" id="${question.name}" name="${question.name}" ${question.required ? 'required' : ''}>`;
            }
        }

        function handleOtherOption(select) {
            const otherInput = document.getElementById(select.name + '_other');
            if (otherInput) {
                if (select.value.includes('Other')) {
                    otherInput.style.display = 'block';
                    otherInput.required = true;
                } else {
                    otherInput.style.display = 'none';
                    otherInput.required = false;
                    otherInput.value = '';
                }
            }
        }

        function handleOtherCheckbox(checkbox) {
            const otherInput = document.getElementById(checkbox.name + '_other');
            if (otherInput) {
                const checkboxes = document.querySelectorAll(`input[name="${checkbox.name}"]:checked`);
                const hasOther = Array.from(checkboxes).some(cb => cb.value.includes('Other'));
                
                if (hasOther) {
                    otherInput.style.display = 'block';
                    otherInput.required = true;
                } else {
                    otherInput.style.display = 'none';
                    otherInput.required = false;
                    otherInput.value = '';
                }
            }
        }

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(`step${stepNumber}`).classList.add('active');
            updateProgress();
        }

        function nextStep() {
            if (!validateCurrentStep()) {
                return;
            }
            
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function collectAnswers() {
            answers = {};
            questions.forEach(question => {
                if (question.type === 'checkbox') {
                    const checkboxes = document.querySelectorAll(`input[name="${question.name}"]:checked`);
                    let values = Array.from(checkboxes).map(cb => cb.value);
                    
                    // Handle "Other" option for checkboxes
                    const otherInput = document.getElementById(question.name + '_other');
                    if (otherInput && otherInput.style.display !== 'none' && otherInput.value) {
                        values = values.map(v => v.includes('Other') ? `Other: ${otherInput.value}` : v);
                    }
                    
                    answers[question.name] = values;
                } else {
                    const element = document.getElementById(question.name);
                    if (element) {
                        let value = element.value;
                        
                        // Handle "Other" option for selects
                        if (question.type === 'select' && value.includes('Other')) {
                            const otherInput = document.getElementById(question.name + '_other');
                            if (otherInput && otherInput.style.display !== 'none' && otherInput.value) {
                                value = `Other: ${otherInput.value}`;
                            }
                        }
                        
                        answers[question.name] = value;
                    }
                }
            });
        }

        function validateCurrentStep() {
            const currentQuestion = questions[currentStep - 1];
            if (!currentQuestion.required) return true;
            
            const element = document.getElementById(currentQuestion.name);
            if (!element) return true;
            
            if (currentQuestion.type === 'checkbox') {
                const checkboxes = document.querySelectorAll(`input[name="${currentQuestion.name}"]:checked`);
                if (checkboxes.length === 0) {
                    alert('Please select at least one option.');
                    return false;
                }
                
                // Check if "Other" is selected but no value provided
                const hasOther = Array.from(checkboxes).some(cb => cb.value.includes('Other'));
                if (hasOther) {
                    const otherInput = document.getElementById(currentQuestion.name + '_other');
                    if (otherInput && otherInput.style.display !== 'none' && !otherInput.value.trim()) {
                        alert('Please specify your "Other" option.');
                        return false;
                    }
                }
            } else {
                if (!element.value.trim()) {
                    alert('This field is required.');
                    element.focus();
                    return false;
                }
                
                // Check if "Other" is selected but no value provided
                if (currentQuestion.type === 'select' && element.value.includes('Other')) {
                    const otherInput = document.getElementById(currentQuestion.name + '_other');
                    if (otherInput && otherInput.style.display !== 'none' && !otherInput.value.trim()) {
                        alert('Please specify your "Other" option.');
                        return false;
                    }
                }
            }
            
            return true;
        }

        function calculateStage() {
            collectAnswers();
            
            // Profile classification
            const businessModelMapping = {
                'B2B (selling to businesses)': 'B2B',
                'B2C (selling to consumers)': 'B2C',
                'B2G (selling to government)': 'B2B',
                'Marketplace (buyers & sellers)': 'B2B',
                'Direct-to-Consumer (D2C)': 'B2C',
                'Subscription (e.g., SaaS)': 'B2B',
                'Consumer App': 'B2C',
                'Other / Not Listed': 'B2B'
            };

            const regionMapping = {
                'North America (US, Canada)': 'Tier1',
                'Western Europe (e.g. UK, Germany, France, Nordics etc.)': 'Tier1',
                'Australia & New Zealand': 'Tier1',
                'East Asia (e.g. China, Japan, Korea, Singapore)': 'Tier1',
                'Central & Eastern Europe': 'Tier2/3',
                'Latin America': 'Tier2/3',
                'Sub-Saharan Africa': 'Tier2/3',
                'Middle East & North Africa (MENA)': 'Tier2/3',
                'South Asia (e.g. India, Pakistan)': 'Tier2/3',
                'Southeast Asia (e.g. Indonesia, Vietnam, Philippines)': 'Tier2/3',
                'Other': 'Tier2/3'
            };

            const businessTypeMapping = {
                'SaaS (Software as a Service)': 'SaaS',
                'Marketplace (connecting buyers/sellers)': 'Marketplace',
                'E-commerce / DTC': 'Other',
                'Hardware / Devices': 'Other',
                'Services (e.g. consulting, agency)': 'Other',
                'Platform / API-based': 'SaaS',
                'Community or Content-led': 'Other',
                'Other': 'Other'
            };

            const industryMapping = {
                'Software / SaaS': 'Lean',
                'Fintech / Insurtech': 'CapitalIntensive',
                'Health / MedTech': 'CapitalIntensive',
                'E-commerce / DTC': 'Lean',
                'Deep Tech / AI / Robotics': 'CapitalIntensive',
                'Education / EdTech': 'Lean',
                'Social Impact / Nonprofit': 'Lean',
                'Other': 'Lean'
            };

            const businessModel = businessModelMapping[answers.businessModel] || 'B2B';
            const region = regionMapping[answers.region] || 'Tier1';
            const businessType = businessTypeMapping[answers.businessType] || 'SaaS';
            const industry = industryMapping[answers.industry] || 'Lean';
            
            const profile = `${businessModel}_${region}_${businessType}_${industry}`;

            // Simplified scoring for demo
            let totalScore = 0;
            let scoreCount = 0;

            // Score quantitative metrics
            const revenue = parseFloat(answers.revenue) || 0;
            const customers = parseFloat(answers.customers) || 0;
            const funding = parseFloat(answers.funding) || 0;
            const teamSize = parseFloat(answers.teamSize) || 1;
            const runway = parseFloat(answers.runway) || 0;

            if (revenue > 100000) totalScore += 9;
            else if (revenue > 50000) totalScore += 5;
            else totalScore += 2;
            scoreCount++;

            if (customers > 100) totalScore += 9;
            else if (customers > 50) totalScore += 5;
            else totalScore += 2;
            scoreCount++;

            if (funding > 1000000) totalScore += 9;
            else if (funding > 500000) totalScore += 5;
            else totalScore += 2;
            scoreCount++;

            if (teamSize > 10) totalScore += 9;
            else if (teamSize > 5) totalScore += 5;
            else totalScore += 2;
            scoreCount++;

            if (runway > 12) totalScore += 9;
            else if (runway > 6) totalScore += 5;
            else totalScore += 2;
            scoreCount++;

            const averageScore = totalScore / scoreCount;

            // Stage mapping
            let stage = 'Ideation';
            if (averageScore >= 7.5) stage = 'Scale';
            else if (averageScore >= 6.5) stage = 'Growth';
            else if (averageScore >= 5.5) stage = 'Early Traction';
            else if (averageScore >= 4.5) stage = 'Validation';
            else stage = 'Ideation';

            // Apply caveats
            if (answers.productReadiness === 'Idea or concept only') {
                stage = 'Ideation';
            }

            if ((!answers.customers || parseFloat(answers.customers) === 0) && (!answers.revenue || parseFloat(answers.revenue) === 0)) {
                stage = 'Ideation';
            }

            stageResult = {
                stage: stage,
                score: averageScore.toFixed(2),
                profile: profile,
                totalScore: totalScore,
                scoreCount: scoreCount
            };

            // Auto-redirect to stage-specific questions
            startStageQuestions();
        }

        function startStageQuestions() {
            // Hide initial form and results
            document.getElementById('startupForm').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            
            // Update title
            document.querySelector('h1').textContent = 'Startup Diagnostic - Stage-Specific Questions';
            
            // Map transition stages to base stages
            const stageMapping = {
                'Ideation': 'Ideation',
                'Ideation → Validation': 'Ideation',
                'Validation': 'Validation',
                'Validation → Early Traction': 'Validation',
                'Early Traction': 'Early Traction',
                'Early Traction → Growth': 'Early Traction',
                'Growth': 'Growth',
                'Growth → Scale': 'Growth',
                'Scale': 'Scale'
            };
            
            const currentStage = stageMapping[stageResult.stage] || 'Ideation';
            const stageQuestionsList = stageQuestions[currentStage];
            
            if (stageQuestionsList) {
                totalStageSteps = stageQuestionsList.length;
                currentStageStep = 1;
                renderStageStep();
            }
        }

        function renderStageStep() {
            const stageMapping = {
                'Ideation': 'Ideation',
                'Ideation → Validation': 'Ideation',
                'Validation': 'Validation',
                'Validation → Early Traction': 'Validation',
                'Early Traction': 'Early Traction',
                'Early Traction → Growth': 'Early Traction',
                'Growth': 'Growth',
                'Growth → Scale': 'Growth',
                'Scale': 'Scale'
            };
            
            const currentStage = stageMapping[stageResult.stage] || 'Ideation';
            const stageQuestionsList = stageQuestions[currentStage];
            
            if (!stageQuestionsList) return;
            
            const question = stageQuestionsList[currentStageStep - 1];
            if (!question) return;
            
            const form = document.getElementById('startupForm');
            form.style.display = 'block';
            form.innerHTML = `
                <div class="form-group">
                    <label for="${question.name}">${question.label}</label>
                    ${generateInput(question)}
                </div>
                <div class="button-row">
                    ${currentStageStep > 1 ? '<button type="button" onclick="prevStageStep()">Back</button>' : '<div></div>'}
                    ${currentStageStep < totalStageSteps ? '<button type="button" onclick="nextStageStep()">Continue</button>' : '<button type="button" onclick="finishStageQuestions()">Finish</button>'}
                </div>
            `;
            
            // Update progress
            const progress = (currentStageStep / totalStageSteps) * 100;
            document.getElementById('progress').style.width = progress + '%';
            document.getElementById('progress').parentElement.previousElementSibling.textContent = `Stage-Specific Question ${currentStageStep} of ${totalStageSteps}`;
        }

        function nextStageStep() {
            saveStageAnswer();
            if (currentStageStep < totalStageSteps) {
                currentStageStep++;
                renderStageStep();
            }
        }

        function prevStageStep() {
            saveStageAnswer();
            if (currentStageStep > 1) {
                currentStageStep--;
                renderStageStep();
            }
        }

        function saveStageAnswer() {
            const stageMapping = {
                'Ideation': 'Ideation',
                'Ideation → Validation': 'Ideation',
                'Validation': 'Validation',
                'Validation → Early Traction': 'Validation',
                'Early Traction': 'Early Traction',
                'Early Traction → Growth': 'Early Traction',
                'Growth': 'Growth',
                'Growth → Scale': 'Growth',
                'Scale': 'Scale'
            };
            
            const currentStage = stageMapping[stageResult.stage] || 'Ideation';
            const stageQuestionsList = stageQuestions[currentStage];
            
            if (!stageQuestionsList) return;
            
            const question = stageQuestionsList[currentStageStep - 1];
            if (!question) return;
            
            const element = document.getElementById(question.name);
            if (element) {
                stageSpecificAnswers[question.name] = element.value;
            }
        }

        function finishStageQuestions() {
            saveStageAnswer();
            showStageResults();
        }

        function showStageResults() {
            const form = document.getElementById('startupForm');
            form.style.display = 'none';
            
            // Calculate individual metric scores
            const revenue = parseFloat(answers.revenue) || 0;
            const customers = parseFloat(answers.customers) || 0;
            const funding = parseFloat(answers.funding) || 0;
            const teamSize = parseFloat(answers.teamSize) || 1;
            const runway = parseFloat(answers.runway) || 0;
            
            let revenueScore = 2;
            if (revenue > 100000) revenueScore = 9;
            else if (revenue > 50000) revenueScore = 5;
            
            let customersScore = 2;
            if (customers > 100) customersScore = 9;
            else if (customers > 50) customersScore = 5;
            
            let fundingScore = 2;
            if (funding > 1000000) fundingScore = 9;
            else if (funding > 500000) fundingScore = 5;
            
            let teamScore = 2;
            if (teamSize > 10) teamScore = 9;
            else if (teamSize > 5) teamScore = 5;
            
            let runwayScore = 2;
            if (runway > 12) runwayScore = 9;
            else if (runway > 6) runwayScore = 5;
            
            // Generate recommendations
            const recommendations = [];
            if (revenueScore <= 2) recommendations.push("Focus on generating early revenue through pilot programmes or beta customers");
            if (customersScore <= 2) recommendations.push("Prioritise customer acquisition and validation of your value proposition");
            if (fundingScore <= 2) recommendations.push("Consider raising funding to accelerate growth and extend runway");
            if (teamScore <= 2) recommendations.push("Build out your team with key hires to support growth");
            if (runwayScore <= 2) recommendations.push("Extend your runway through cost optimisation or additional funding");
            
            const results = document.getElementById('results');
            results.style.display = 'block';
            results.innerHTML = `
                <h2>📊 Your Complete Startup Diagnostic Results</h2>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3 style="font-size: 24px; color: #0D9488; margin-bottom: 15px;">You're currently in: ${stageResult.stage.toUpperCase()}</h3>
                    <p><strong>Overall Score:</strong> ${stageResult.score}/10</p>
                    <p><strong>Profile:</strong> ${stageResult.profile}</p>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h4>Metric Breakdown:</h4>
                    <div class="metric-score">
                        <span class="label">Revenue:</span>
                        <span class="score score-${revenueScore <= 2 ? 'red' : revenueScore <= 5 ? 'amber' : 'green'}">${revenueScore}/10</span>
                    </div>
                    <div class="metric-score">
                        <span class="label">Customers:</span>
                        <span class="score score-${customersScore <= 2 ? 'red' : customersScore <= 5 ? 'amber' : 'green'}">${customersScore}/10</span>
                    </div>
                    <div class="metric-score">
                        <span class="label">Funding:</span>
                        <span class="score score-${fundingScore <= 2 ? 'red' : fundingScore <= 5 ? 'amber' : 'green'}">${fundingScore}/10</span>
                    </div>
                    <div class="metric-score">
                        <span class="label">Team Size:</span>
                        <span class="score score-${teamScore <= 2 ? 'red' : teamScore <= 5 ? 'amber' : 'green'}">${teamScore}/10</span>
                    </div>
                    <div class="metric-score">
                        <span class="label">Runway:</span>
                        <span class="score score-${runwayScore <= 2 ? 'red' : runwayScore <= 5 ? 'amber' : 'green'}">${runwayScore}/10</span>
                    </div>
                </div>
                
                ${recommendations.length > 0 ? `
                <div class="recommendations">
                    <h4>💡 Recommendations:</h4>
                    <ul>
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
                
                <div style="margin-top: 20px;">
                    <button onclick="generateAIReport()" style="background: #0D9488; margin-right: 10px;">🤖 Generate AI Report</button>
                    <button onclick="restartForm()" style="margin-right: 10px;">Start Over</button>
                    <button onclick="exportCompleteData()" style="margin-right: 10px;">Export Data</button>
                    <button onclick="submitToGoogleSheets()" style="background: #4285f4;">Submit to Google Sheets</button>
                </div>
            `;
        }

        function generateAIReport() {
            const results = document.getElementById('results');
            const existingContent = results.innerHTML;
            
            results.innerHTML = existingContent + `
                <div class="success-message">
                    <h3>🤖 Generating AI Analysis...</h3>
                    <p>Please wait while our AI analyses your startup data and generates a comprehensive report...</p>
                    <div style="margin-top: 10px;">
                        <label>
                            <input type="checkbox" id="useRealAI" onchange="toggleAIAnalysis()"> Use Real AI (OpenAI/Claude)
                        </label>
                    </div>
                </div>
            `;

            // Prepare data for AI analysis
            const aiData = {
                startup: {
                    name: answers.companyName || 'Unknown',
                    founder: answers.founderName || 'Unknown',
                    email: answers.email || 'Unknown',
                    website: answers.companyWebsite || 'N/A',
                    stage: stageResult.stage,
                    score: stageResult.score,
                    profile: stageResult.profile
                },
                metrics: {
                    revenue: parseFloat(answers.revenue) || 0,
                    customers: parseFloat(answers.customers) || 0,
                    funding: parseFloat(answers.funding) || 0,
                    teamSize: parseFloat(answers.teamSize) || 1,
                    runway: parseFloat(answers.runway) || 0
                },
                business: {
                    model: answers.businessModel || 'Unknown',
                    region: answers.region || 'Unknown',
                    type: answers.businessType || 'Unknown',
                    industry: answers.industry || 'Unknown',
                    productReadiness: answers.productReadiness || 'Unknown',
                    goToMarket: answers.goToMarket || 'Unknown',
                    engagementQuality: answers.engagementQuality || 'Unknown'
                },
                narrative: {
                    opportunity: answers.opportunitySolution || 'Not provided',
                    whyNow: answers.whyNow || 'Not provided',
                    targetCustomer: answers.targetCustomer || 'Not provided',
                    marketSizing: answers.marketSizing || 'Not provided',
                    risksAssumptions: answers.risksAssumptions || 'Not provided',
                    founderProfiles: answers.founderProfiles || 'Not provided',
                    teamStory: answers.teamStory || 'Not provided'
                },
                traction: {
                    signals: answers.tractionSignals || [],
                    goals: answers.goals || []
                },
                stageSpecific: stageSpecificAnswers
            };

            // Check if user wants real AI
            const useRealAI = document.getElementById('useRealAI')?.checked || false;
            
            if (useRealAI) {
                callRealAI(aiData);
            } else {
                // Use enhanced rule-based analysis
                setTimeout(() => {
                    const aiReport = generateComprehensiveReport(aiData);
                    displayAIReport(aiReport);
                }, 3000);
            }
        }

        function toggleAIAnalysis() {
            const useRealAI = document.getElementById('useRealAI').checked;
            const results = document.getElementById('results');
            const successMessage = results.querySelector('.success-message');
            
            if (successMessage) {
                const statusText = successMessage.querySelector('p');
                if (statusText) {
                    statusText.textContent = useRealAI ? 
                        'Connecting to AI service... Please ensure you have API keys configured.' :
                        'Using enhanced rule-based analysis...';
                }
            }
        }

        async function callRealAI(data) {
            try {
                // Example OpenAI integration
                const prompt = generateAIPrompt(data);
                
                // You would need to configure your API key
                const response = await callOpenAI(prompt);
                
                if (response.success) {
                    displayAIReport(response.report);
                } else {
                    // Fallback to rule-based analysis
                    console.log('AI API failed, using rule-based analysis');
                    const aiReport = generateComprehensiveReport(data);
                    displayAIReport(aiReport);
                }
            } catch (error) {
                console.error('AI API error:', error);
                // Fallback to rule-based analysis
                const aiReport = generateComprehensiveReport(data);
                displayAIReport(aiReport);
            }
        }

        function generateAIPrompt(data) {
            return `Analyze this startup data and provide a comprehensive report:

Startup: ${data.startup.name}
Stage: ${data.startup.stage}
Industry: ${data.business.industry}
Revenue: $${data.metrics.revenue}
Customers: ${data.metrics.customers}
Funding: $${data.metrics.funding}
Team Size: ${data.metrics.teamSize}
Runway: ${data.metrics.runway} months

Business Model: ${data.business.model}
Region: ${data.business.region}
Product Readiness: ${data.business.productReadiness}

Please provide:
1. Executive Summary
2. Strengths and Weaknesses
3. Opportunities and Threats
4. Strategic Recommendations
5. Next Steps for ${data.startup.stage} stage
6. Risk Assessment
7. Growth Potential Analysis

Format as JSON with keys: executiveSummary, strengths, weaknesses, opportunities, threats, recommendations, nextSteps, riskScore, growthPotential, marketPosition, competitiveAdvantage, financialHealth, teamReadiness`;
        }

        async function callOpenAI(prompt) {
            // This is a placeholder - you would need to implement with your API key
            const API_KEY = 'your-openai-api-key'; // Replace with actual key
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: [
                            {
                                role: "system",
                                content: "You are an expert startup analyst. Provide detailed, actionable insights based on startup data. Return responses in valid JSON format."
                            },
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    throw new Error(`API call failed: ${response.status}`);
                }

                const result = await response.json();
                const aiResponse = result.choices[0].message.content;
                
                // Parse AI response
                try {
                    const parsedReport = JSON.parse(aiResponse);
                    return { success: true, report: parsedReport };
                } catch (parseError) {
                    console.error('Failed to parse AI response:', parseError);
                    return { success: false, error: 'Invalid AI response format' };
                }
            } catch (error) {
                console.error('OpenAI API error:', error);
                return { success: false, error: error.message };
            }
        }

        // Alternative: Claude API integration
        async function callClaude(prompt) {
            const API_KEY = 'your-claude-api-key'; // Replace with actual key
            
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'x-api-key': API_KEY,
                        'Content-Type': 'application/json',
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: "claude-3-sonnet-20240229",
                        messages: [
                            {
                                role: "user",
                                content: prompt
                            }
                        ],
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    throw new Error(`API call failed: ${response.status}`);
                }

                const result = await response.json();
                const aiResponse = result.content[0].text;
                
                try {
                    const parsedReport = JSON.parse(aiResponse);
                    return { success: true, report: parsedReport };
                } catch (parseError) {
                    console.error('Failed to parse AI response:', parseError);
                    return { success: false, error: 'Invalid AI response format' };
                }
            } catch (error) {
                console.error('Claude API error:', error);
                return { success: false, error: error.message };
            }
        }

        function generateComprehensiveReport(data) {
            const { startup, metrics, business, narrative, traction, stageSpecific } = data;
            
            // Enhanced AI Logic for Analysis
            const analysis = {
                strengths: [],
                weaknesses: [],
                opportunities: [],
                threats: [],
                recommendations: [],
                nextSteps: [],
                riskScore: 0,
                growthPotential: 0,
                marketPosition: '',
                competitiveAdvantage: '',
                financialHealth: '',
                teamReadiness: ''
            };

            // Industry-specific benchmarks
            const industryBenchmarks = {
                'SaaS': { revenuePerCustomer: 5000, churnRate: 0.05, ltv: 50000 },
                'E-commerce': { revenuePerCustomer: 200, churnRate: 0.15, ltv: 500 },
                'Fintech': { revenuePerCustomer: 10000, churnRate: 0.03, ltv: 100000 },
                'Healthtech': { revenuePerCustomer: 8000, churnRate: 0.04, ltv: 80000 },
                'Edtech': { revenuePerCustomer: 3000, churnRate: 0.08, ltv: 30000 }
            };

            // Multi-factor scoring system
            let totalScore = 0;
            let maxScore = 0;

            // Revenue Analysis (25% weight)
            const revenueScore = analyzeRevenue(metrics.revenue, business.industry, startup.stage);
            totalScore += revenueScore.score;
            maxScore += 25;
            
            if (revenueScore.score >= 20) {
                analysis.strengths.push("Exceptional revenue performance for stage");
                analysis.financialHealth = 'Strong';
            } else if (revenueScore.score >= 15) {
                analysis.strengths.push("Good revenue traction indicating market demand");
                analysis.financialHealth = 'Good';
            } else {
                analysis.weaknesses.push(revenueScore.insight);
                analysis.recommendations.push(revenueScore.recommendation);
                analysis.financialHealth = 'Needs Attention';
            }

            // Customer Analysis (20% weight)
            const customerScore = analyzeCustomers(metrics.customers, business.industry, startup.stage);
            totalScore += customerScore.score;
            maxScore += 20;
            
            if (customerScore.score >= 16) {
                analysis.strengths.push("Strong customer acquisition and retention");
            } else {
                analysis.weaknesses.push(customerScore.insight);
                analysis.recommendations.push(customerScore.recommendation);
            }

            // Funding Analysis (15% weight)
            const fundingScore = analyzeFunding(metrics.funding, startup.stage, metrics.runway);
            totalScore += fundingScore.score;
            maxScore += 15;
            
            if (fundingScore.score >= 12) {
                analysis.strengths.push("Strong capital position for growth");
            } else {
                analysis.weaknesses.push(fundingScore.insight);
                analysis.recommendations.push(fundingScore.recommendation);
            }

            // Team Analysis (15% weight)
            const teamScore = analyzeTeam(metrics.teamSize, startup.stage, business.industry);
            totalScore += teamScore.score;
            maxScore += 15;
            
            if (teamScore.score >= 12) {
                analysis.strengths.push("Well-sized team for current stage");
                analysis.teamReadiness = 'Strong';
            } else {
                analysis.weaknesses.push(teamScore.insight);
                analysis.recommendations.push(teamScore.recommendation);
                analysis.teamReadiness = 'Needs Growth';
            }

            // Runway Analysis (15% weight)
            const runwayScore = analyzeRunway(metrics.runway, startup.stage, metrics.revenue);
            totalScore += runwayScore.score;
            maxScore += 15;
            
            if (runwayScore.score < 10) {
                analysis.threats.push("Critical runway situation requiring immediate attention");
                analysis.riskScore += 30;
            }

            // Market Position Analysis (10% weight)
            const marketScore = analyzeMarketPosition(business, narrative, traction);
            totalScore += marketScore.score;
            maxScore += 10;
            
            analysis.marketPosition = marketScore.position;
            analysis.competitiveAdvantage = marketScore.advantage;

            // Calculate overall scores
            analysis.growthPotential = Math.round((totalScore / maxScore) * 100);
            analysis.riskScore = Math.min(100, analysis.riskScore + (100 - analysis.growthPotential));

            // Generate opportunities and threats
            generateOpportunitiesAndThreats(analysis, business, metrics, startup.stage);

            // Stage-specific strategic guidance
            generateStageSpecificGuidance(analysis, startup.stage, metrics, business);

            // Generate executive summary
            const executiveSummary = generateExecutiveSummary(startup, analysis, business);

            return {
                executiveSummary: executiveSummary,
                analysis: analysis,
                metrics: metrics,
                stage: startup.stage,
                score: startup.score,
                benchmarks: industryBenchmarks[business.industry] || industryBenchmarks['SaaS']
            };
        }

        // Enhanced Analysis Functions
        function analyzeRevenue(revenue, industry, stage) {
            const benchmarks = {
                'Ideation': { min: 0, good: 10000, excellent: 50000 },
                'Validation': { min: 5000, good: 25000, excellent: 100000 },
                'Early Traction': { min: 25000, good: 100000, excellent: 500000 },
                'Growth': { min: 100000, good: 500000, excellent: 2000000 },
                'Scale': { min: 500000, good: 2000000, excellent: 10000000 }
            };

            const benchmark = benchmarks[stage] || benchmarks['Ideation'];
            
            if (revenue >= benchmark.excellent) {
                return { score: 25, insight: "Exceptional revenue for stage", recommendation: "Focus on scaling successful channels" };
            } else if (revenue >= benchmark.good) {
                return { score: 20, insight: "Good revenue traction", recommendation: "Optimise pricing and expand customer base" };
            } else if (revenue >= benchmark.min) {
                return { score: 15, insight: "Basic revenue generation", recommendation: "Implement pilot programmes and validate pricing" };
            } else {
                return { score: 10, insight: "Limited revenue - need monetisation strategy", recommendation: "Focus on product-market fit and early adopters" };
            }
        }

        function analyzeCustomers(customers, industry, stage) {
            const benchmarks = {
                'Ideation': { min: 0, good: 10, excellent: 50 },
                'Validation': { min: 5, good: 25, excellent: 100 },
                'Early Traction': { min: 20, good: 100, excellent: 500 },
                'Growth': { min: 100, good: 500, excellent: 2000 },
                'Scale': { min: 500, good: 2000, excellent: 10000 }
            };

            const benchmark = benchmarks[stage] || benchmarks['Ideation'];
            
            if (customers >= benchmark.excellent) {
                return { score: 20, insight: "Strong customer base", recommendation: "Focus on retention and expansion" };
            } else if (customers >= benchmark.good) {
                return { score: 16, insight: "Good customer traction", recommendation: "Scale acquisition channels" };
            } else if (customers >= benchmark.min) {
                return { score: 12, insight: "Basic customer base", recommendation: "Accelerate customer acquisition" };
            } else {
                return { score: 8, insight: "Small customer base", recommendation: "Focus on customer discovery and validation" };
            }
        }

        function analyzeFunding(funding, stage, runway) {
            const benchmarks = {
                'Ideation': { min: 0, good: 50000, excellent: 250000 },
                'Validation': { min: 25000, good: 250000, excellent: 1000000 },
                'Early Traction': { min: 100000, good: 1000000, excellent: 5000000 },
                'Growth': { min: 500000, good: 5000000, excellent: 20000000 },
                'Scale': { min: 2000000, good: 20000000, excellent: 100000000 }
            };

            const benchmark = benchmarks[stage] || benchmarks['Ideation'];
            
            if (funding >= benchmark.excellent) {
                return { score: 15, insight: "Strong funding position", recommendation: "Invest in growth and expansion" };
            } else if (funding >= benchmark.good) {
                return { score: 12, insight: "Good funding for stage", recommendation: "Consider strategic investments" };
            } else if (funding >= benchmark.min) {
                return { score: 9, insight: "Basic funding secured", recommendation: "Consider raising additional funding" };
            } else {
                return { score: 6, insight: "Limited funding may constrain growth", recommendation: "Prioritise fundraising or revenue generation" };
            }
        }

        function analyzeTeam(teamSize, stage, industry) {
            const benchmarks = {
                'Ideation': { min: 1, good: 3, excellent: 5 },
                'Validation': { min: 2, good: 5, excellent: 10 },
                'Early Traction': { min: 3, good: 8, excellent: 15 },
                'Growth': { min: 5, good: 15, excellent: 30 },
                'Scale': { min: 10, good: 30, excellent: 100 }
            };

            const benchmark = benchmarks[stage] || benchmarks['Ideation'];
            
            if (teamSize >= benchmark.excellent) {
                return { score: 15, insight: "Well-staffed for stage", recommendation: "Focus on team culture and efficiency" };
            } else if (teamSize >= benchmark.good) {
                return { score: 12, insight: "Good team size for stage", recommendation: "Consider strategic hires" };
            } else if (teamSize >= benchmark.min) {
                return { score: 9, insight: "Lean team structure", recommendation: "Build out key roles" };
            } else {
                return { score: 6, insight: "Understaffed for growth", recommendation: "Prioritise key hires" };
            }
        }

        function analyzeRunway(runway, stage, revenue) {
            const benchmarks = {
                'Ideation': { min: 3, good: 6, excellent: 12 },
                'Validation': { min: 6, good: 12, excellent: 18 },
                'Early Traction': { min: 6, good: 12, excellent: 18 },
                'Growth': { min: 12, good: 18, excellent: 24 },
                'Scale': { min: 18, good: 24, excellent: 36 }
            };

            const benchmark = benchmarks[stage] || benchmarks['Ideation'];
            
            if (runway >= benchmark.excellent) {
                return { score: 15, insight: "Excellent runway for growth", recommendation: "Invest in long-term initiatives" };
            } else if (runway >= benchmark.good) {
                return { score: 12, insight: "Good runway position", recommendation: "Monitor burn rate closely" };
            } else if (runway >= benchmark.min) {
                return { score: 9, insight: "Adequate runway", recommendation: "Focus on revenue or funding" };
            } else {
                return { score: 6, insight: "Critical runway situation", recommendation: "Immediate action required - extend runway" };
            }
        }

        function analyzeMarketPosition(business, narrative, traction) {
            let score = 10;
            let position = 'Emerging';
            let advantage = 'Innovation';

            // Analyze business model strength
            if (business.model.includes('B2B')) {
                score += 2;
                advantage = 'B2B Relationships';
            }
            if (business.model.includes('SaaS')) {
                score += 3;
                advantage = 'Recurring Revenue Model';
            }

            // Analyze market maturity
            if (business.region.includes('Tier1')) {
                score += 2;
                position = 'Established Market';
            }

            // Analyze narrative quality
            if (narrative.opportunity.length > 150) score += 1;
            if (narrative.targetCustomer.length > 100) score += 1;
            if (traction.signals.length > 2) score += 1;

            return { score: Math.min(10, score), position, advantage };
        }

        function generateOpportunitiesAndThreats(analysis, business, metrics, stage) {
            // Opportunities
            if (business.model.includes('B2B')) {
                analysis.opportunities.push("High-value B2B contracts potential");
            }
            if (business.region.includes('Emerging')) {
                analysis.opportunities.push("First-mover advantage in emerging market");
            }
            if (metrics.revenue > 100000) {
                analysis.opportunities.push("Strong foundation for scaling operations");
            }

            // Threats
            if (metrics.runway < 6) {
                analysis.threats.push("Cash flow risk requiring immediate attention");
            }
            if (business.industry === 'Fintech' && metrics.funding < 500000) {
                analysis.threats.push("Regulatory compliance costs may strain resources");
            }
            if (stage === 'Scale' && metrics.teamSize < 20) {
                analysis.threats.push("Team capacity may limit scaling potential");
            }
        }

        function generateStageSpecificGuidance(analysis, stage, metrics, business) {
            const guidance = {
                'Ideation': [
                    "Conduct 50+ customer interviews to validate problem",
                    "Build MVP with core features only",
                    "Define clear value proposition",
                    "Test multiple customer segments"
                ],
                'Validation': [
                    "Scale customer acquisition channels",
                    "Optimise conversion funnel",
                    "Implement pricing strategy",
                    "Build repeatable sales process"
                ],
                'Early Traction': [
                    "Expand to new customer segments",
                    "Optimise unit economics",
                    "Build scalable operations",
                    "Develop strategic partnerships"
                ],
                'Growth': [
                    "Enter new markets/geographies",
                    "Develop additional product lines",
                    "Build strong team culture",
                    "Optimise for efficiency"
                ],
                'Scale': [
                    "Focus on profitability",
                    "Consider strategic partnerships",
                    "Prepare for potential exit",
                    "Optimise organisational structure"
                ]
            };

            analysis.nextSteps = guidance[stage] || guidance['Ideation'];
        }

        function generateExecutiveSummary(startup, analysis, business) {
            const health = analysis.financialHealth === 'Strong' ? 'excellent' : 
                          analysis.financialHealth === 'Good' ? 'good' : 'needs attention';
            
            const potential = analysis.growthPotential >= 80 ? 'high' :
                            analysis.growthPotential >= 60 ? 'moderate' : 'limited';

            return `
                ${startup.name} is a ${business.industry} company operating in the ${business.region} market. 
                Currently in the ${startup.stage} stage with a ${startup.score}/10 overall score, 
                the company shows ${potential} growth potential with ${health} financial health. 
                Key competitive advantages include ${analysis.competitiveAdvantage.toLowerCase()}, 
                positioning the company as ${analysis.marketPosition.toLowerCase()} in their market. 
                Critical focus areas include ${analysis.recommendations.slice(0, 3).join(', ')}.
            `.trim();
        }

        function displayAIReport(report) {
            const results = document.getElementById('results');
            const existingContent = results.innerHTML.replace(/<div class="success-message">[\s\S]*?<\/div>/, '');
            
            results.innerHTML = existingContent + `
                <div style="background: #FEF3C7; border-left: 4px solid #F59E0B; padding: 20px; margin: 20px 0; border-radius: 8px;">
                    <h3>🤖 AI-Generated Startup Analysis Report</h3>
                    
                    <div style="background: white; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h4>📋 Executive Summary</h4>
                        <p>${report.executiveSummary}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                        <div style="background: #D1FAE5; padding: 15px; border-radius: 5px;">
                            <h4>📊 Key Metrics</h4>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Growth Potential:</span>
                                <span style="font-weight: bold; color: ${report.analysis.growthPotential >= 80 ? '#059669' : report.analysis.growthPotential >= 60 ? '#F59E0B' : '#DC2626'}">${report.analysis.growthPotential}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Risk Score:</span>
                                <span style="font-weight: bold; color: ${report.analysis.riskScore <= 20 ? '#059669' : report.analysis.riskScore <= 40 ? '#F59E0B' : '#DC2626'}">${report.analysis.riskScore}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Financial Health:</span>
                                <span style="font-weight: bold; color: ${report.analysis.financialHealth === 'Strong' ? '#059669' : report.analysis.financialHealth === 'Good' ? '#F59E0B' : '#DC2626'}">${report.analysis.financialHealth}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Team Readiness:</span>
                                <span style="font-weight: bold; color: ${report.analysis.teamReadiness === 'Strong' ? '#059669' : '#F59E0B'}">${report.analysis.teamReadiness}</span>
                            </div>
                        </div>
                        
                        <div style="background: #FEE2E2; padding: 15px; border-radius: 5px;">
                            <h4>🎯 Market Position</h4>
                            <p><strong>Position:</strong> ${report.analysis.marketPosition}</p>
                            <p><strong>Competitive Advantage:</strong> ${report.analysis.competitiveAdvantage}</p>
                            <p><strong>Industry:</strong> ${report.business?.industry || 'Unknown'}</p>
                            <p><strong>Stage:</strong> ${report.stage}</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                        <div style="background: #D1FAE5; padding: 15px; border-radius: 5px;">
                            <h4>✅ Strengths (${report.analysis.strengths.length})</h4>
                            <ul>
                                ${report.analysis.strengths.map(s => `<li>${s}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="background: #FEE2E2; padding: 15px; border-radius: 5px;">
                            <h4>⚠️ Areas for Improvement (${report.analysis.weaknesses.length})</h4>
                            <ul>
                                ${report.analysis.weaknesses.map(w => `<li>${w}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                        <div style="background: #DBEAFE; padding: 15px; border-radius: 5px;">
                            <h4>🚀 Opportunities (${report.analysis.opportunities.length})</h4>
                            <ul>
                                ${report.analysis.opportunities.map(o => `<li>${o}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div style="background: #FEF3C7; padding: 15px; border-radius: 5px;">
                            <h4>⚠️ Threats (${report.analysis.threats.length})</h4>
                            <ul>
                                ${report.analysis.threats.map(t => `<li>${t}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <div style="background: #F3F4F6; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h4>💡 Strategic Recommendations</h4>
                        <ol>
                            ${report.analysis.recommendations.map(r => `<li>${r}</li>`).join('')}
                        </ol>
                    </div>
                    
                    <div style="background: #E0E7FF; padding: 15px; border-radius: 5px; margin: 15px 0;">
                        <h4>🎯 Next Steps for ${report.stage} Stage</h4>
                        <ol>
                            ${report.analysis.nextSteps.map(s => `<li>${s}</li>`).join('')}
                        </ol>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button onclick="downloadAIReport()" style="background: #0D9488; margin-right: 10px;">📄 Download Report</button>
                        <button onclick="shareAIReport()" style="background: #F59E0B; margin-right: 10px;">📤 Share Report</button>
                    </div>
                </div>
            `;
        }

        function downloadAIReport() {
            // Implementation for downloading the AI report as PDF
            alert('AI Report download feature would be implemented here');
        }

        function shareAIReport() {
            // Implementation for sharing the AI report
            alert('AI Report sharing feature would be implemented here');
        }

        function restartForm() {
            currentStep = 1;
            answers = {};
            stageResult = {};
            stageSpecificAnswers = {};
            currentStageStep = 1;
            totalStageSteps = 0;
            
            document.getElementById('startupForm').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.querySelector('h1').textContent = 'Startup Diagnostic - Initial Assessment';
            
            // Reset form
            document.querySelectorAll('input, select, textarea').forEach(element => {
                if (element.type === 'checkbox' || element.type === 'radio') {
                    element.checked = false;
                } else {
                    element.value = '';
                }
            });
            
            initializeForm();
        }

        function exportCompleteData() {
            const data = {
                timestamp: new Date().toISOString(),
                initialAnswers: answers,
                stageResult: stageResult,
                stageSpecificAnswers: stageSpecificAnswers
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'startup-diagnostic-results.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function submitToGoogleSheets() {
            // Collect all data
            const data = {
                submissionDate: new Date().toLocaleDateString(),
                timestamp: new Date().toISOString(),
                founderName: answers.founderName || '',
                email: answers.email || '',
                companyName: answers.companyName || '',
                companyWebsite: answers.companyWebsite || '',
                calculatedStage: stageResult.stage,
                overallScore: stageResult.score,
                profile: stageResult.profile,
                opportunitySolution: answers.opportunitySolution || '',
                whyNow: answers.whyNow || '',
                marketSizing: answers.marketSizing || '',
                targetCustomer: answers.targetCustomer || '',
                customers: answers.customers || '',
                engagementQuality: answers.engagementQuality || '',
                goToMarket: answers.goToMarket || '',
                businessModel: answers.businessModel || '',
                region: answers.region || '',
                businessType: answers.businessType || '',
                industry: answers.industry || '',
                productReadiness: answers.productReadiness || '',
                revenue: answers.revenue || '',
                runway: answers.runway || '',
                funding: answers.funding || '',
                risksAssumptions: answers.risksAssumptions || '',
                tractionSignals: answers.tractionSignals || '',
                founderProfiles: answers.founderProfiles || '',
                teamSize: answers.teamSize || '',
                teamStory: answers.teamStory || '',
                goals: answers.goals || '',
                otherInformation: answers.otherInformation || '',
                ...stageSpecificAnswers
            };

            // Show loading state
            const results = document.getElementById('results');
            const existingContent = results.innerHTML;
            
            results.innerHTML = existingContent + `
                <div class="success-message">
                    <h3>Submitting to Google Sheets...</h3>
                    <p>Please wait while we submit your data...</p>
                </div>
            `;

            // Replace with your Google Apps Script web app URL
            const scriptUrl = 'https://script.google.com/macros/s/AKfycbx5FIulQupW6i3yTu7qOj0WLcXaFw_vbK8xUZ1iNhZ1zFvSl51ShamhENdEbjMjv-AB9A/exec';
            
            console.log('Submitting data:', data);
            console.log('Script URL:', scriptUrl);
            
            // Try to bypass CORS with a different approach
            const formData = new FormData();
            formData.append('data', JSON.stringify(data));
            
            // Add a timestamp to prevent caching
            const urlWithTimestamp = scriptUrl + '?t=' + Date.now();
            
            // Try a different approach - use a simple POST without complex headers
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = urlWithTimestamp;
            form.target = 'hidden-iframe';
            
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'data';
            input.value = JSON.stringify(data);
            form.appendChild(input);
            
            // Create hidden iframe to handle the response
            const iframe = document.createElement('iframe');
            iframe.name = 'hidden-iframe';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            // Submit the form
            document.body.appendChild(form);
            form.submit();
            
            // Remove the form and iframe
            setTimeout(() => {
                document.body.removeChild(form);
                document.body.removeChild(iframe);
                
                // Show success message (since we can't read the response due to CORS)
                results.innerHTML = existingContent + `
                    <div class="success-message">
                        <h3>✅ Data Submitted Successfully!</h3>
                        <p><strong>Stage:</strong> ${stageResult.stage}</p>
                        <p><strong>Score:</strong> ${stageResult.score}/10</p>
                        <p><strong>Profile:</strong> ${stageResult.profile}</p>
                        <p><strong>Company:</strong> ${answers.companyName || 'N/A'}</p>
                        <p><strong>Email:</strong> ${answers.email || 'N/A'}</p>
                        <p><strong>Revenue:</strong> $${answers.revenue || '0'}</p>
                        <p><strong>Customers:</strong> ${answers.customers || '0'}</p>
                        <p><strong>Funding:</strong> $${answers.funding || '0'}</p>
                        <p><strong>Team Size:</strong> ${answers.teamSize || '1'}</p>
                        <p><strong>Runway:</strong> ${answers.runway || '0'} months</p>
                        <p><strong>Data has been submitted to Google Sheets.</strong></p>
                        <p><em>Note: Due to browser security restrictions, we cannot confirm the response, but the data has been sent.</em></p>
                    </div>
                `;
            }, 2000);
        }

        // Initialize - show consent screen first
        // initializeForm(); // This will be called after consent
    </script>
</body>
</html>
